/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 7 13:54
*/
KISSY.add("overlay/extension/loading",function(){function e(){}e.prototype={loading:function(){this.get("view").loading();return this},unloading:function(){this.get("view").unloading();return this}};return e});
KISSY.add("overlay/extension/mask",function(e,d){function c(){}function a(a,c,e,d){var k=a.effect||b;if(k==b)d.ksSetMaskVisible(e);else{d.ksSetMaskVisible(e);var d=a.duration,a=a.easing,o=e?1:0;c.stop(1,1);c.css("display",e?b:"block");c[k+f[k][o]](d,function(){c.css("display","")},a)}}c.ATTRS={mask:{view:1,value:!1},maskNode:{view:1}};var b="none",f={fade:["Out","In"],slide:["Up","Down"]};c.prototype={__bindUI:function(){var b,c,e=this.get("el"),f=this.get("view");if(c=this.get("mask")){b=this.get("maskNode");
if(c.closeOnClick)b.on(d.Gesture.tap,this.close,this);this.on("afterVisibleChange",function(k){if(k=k.newVal){var d=parseInt(e.css("z-index"))||1;b.css("z-index",d-1)}a(c,b,k,f)})}}};return c},{requires:["node"]});
KISSY.add("overlay/extension/loading-render",function(e,d){function c(){}c.prototype={loading:function(){this._loadingExtEl||(this._loadingExtEl=(new d("<div class='"+this.prefixCls+"ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'/>")).appendTo(this.get("el")));this._loadingExtEl.show()},unloading:function(){var a=this._loadingExtEl;a&&a.hide()}};return c},{requires:["node"]});
KISSY.add("overlay/close-tpl",function(){return'{{#if closable}} <a href="javascript:void(\'close\')" id="ks-ext-close-{{id}}" class="{{getBaseCssClasses "close"}}" role=\'button\'> <span class="{{getBaseCssClasses "close-x"}}">close</span> </a> {{/if}}'});
KISSY.add("overlay/extension/mask-render",function(e,d){function c(a){a=a.getBaseCssClasses("mask");a=f("<div  style='width:"+(b?"expression(KISSY.DOM.docWidth())":"100%")+";left:0;top:0;height:"+(b?"expression(KISSY.DOM.docHeight())":"100%")+";position:"+(b?"absolute":"fixed")+";' class='"+a+"'>"+(b?"<iframe style='position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'></iframe>":
"")+"</div>").prependTo("body");a.unselectable();a.on("mousedown",function(a){a.preventDefault()});return a}function a(){}var b=6===e.UA.ie,f=d.all;a.ATTRS={mask:{},maskNode:{}};a.prototype={__renderUI:function(){this.get("mask")&&this.set("maskNode",c(this))},__syncUI:function(){this.get("mask")&&this.ksSetMaskVisible(this.get("visible"))},ksSetMaskVisible:function(a){var b=this.get("maskNode"),c=this.getBaseCssClasses("mask-hidden");a?b.removeClass(c):b.addClass(c)},__destructor:function(){var a;
(a=this.get("maskNode"))&&a.remove()}};return a},{requires:["node"]});
KISSY.add("overlay/overlay-render",function(e,d,c,a,b,f){return d.Render.extend([c.ContentRender,c.ShimRender,c.PositionRender,a,f],{initializer:function(){e.mix(this.get("childrenElSelectors"),{closeBtn:"#ks-ext-close-{id}"})}},{HTML_PARSER:{closeBtn:function(a){return a.one("."+this.getBaseCssClass("close"))}},ATTRS:{closable:{},contentTpl:{value:b+c.ContentRender.ContentTpl}}})},{requires:["component/base","component/extension","./extension/loading-render","./close-tpl","./extension/mask-render"]});
KISSY.add("overlay/extension/overlay-effect",function(e){function d(a){var b=a.get("el").clone(!0);b.css({visibility:"visible",overflow:h}).addClass(a.prefixCls+"overlay-ghost");return a.__afterCreateEffectGhost(b)}function c(a,b,c){a.__effectGhost&&a.__effectGhost.stop(1,1);var f=a.get("el"),i=e.all,j=a.get("effect"),g=i(j.target),i=j.duration,g=e.mix(g.offset(),{width:g.width(),height:g.height()}),l=e.mix(f.offset(),{width:f.width(),height:f.height()}),m=d(a),j=j.easing;m.insertAfter(f);f.css("visibility",
h);b?(b=g,g=l):b=l;m.css(b);a.__effectGhost=m;m.animate(g,{duration:i,easing:j,complete:function(){a.__effectGhost=null;m.remove();f.css("visibility","");c()}})}function a(a,b,e){var d=a.get("el"),h=a.get("effect"),n=h.effect||f,g=h.target;n==f&&!g?e():g?c(a,b,e):(a=h.duration,h=h.easing,g=b?1:0,d.stop(1,1),d.css({visibility:j,display:b?f:i}),d[n+l[n][g]](a,function(){d.css({display:i,visibility:""});e()},h))}function b(){}var f="none",i="block",h="hidden",j="visible",l={fade:["Out","In"],slide:["Up",
"Down"]};b.ATTRS={effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var b=a.effect;"string"==typeof b&&!l[b]&&(a.effect="")}}};b.prototype={__afterCreateEffectGhost:function(a){return a},_onSetVisible:function(b){var c=this;a(c,b,function(){c.fire(b?"show":"hide")})}};return b});
KISSY.add("overlay/base",function(e,d,c,a,b,f,i){var h={hide:"hide",destroy:"destroy"};return d.Controller.extend([c.DecorateChild,c.Position,a,c.Align,b,i],{bindUI:function(){var a=this,b=a.get("closeBtn");if(b)b.on("click",function(b){a.close();b.preventDefault()})},close:function(){this[h[this.get("closeAction")]||"hide"]();return this}},{ATTRS:{contentEl:{view:1},closable:{value:!1,view:1},closeBtn:{view:1},closeAction:{value:"hide"},focusable:{value:!1},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},
xrender:{value:f}}},{xclass:"overlay"})},{requires:"component/base,component/extension,./extension/loading,./extension/mask,./overlay-render,./extension/overlay-effect".split(",")});KISSY.add("overlay/dialog-tpl",function(){return'<div id="ks-content-{{id}}" class="{{getBaseCssClasses "content"}}"> <div class="{{getBaseCssClasses "header"}}" style=" {{#each headerStyle}} {{xkey}}:{{.}}; {{/each}} " id="ks-stdmod-header-{{id}}">{{{headerContent}}}</div> <div class="{{getBaseCssClasses "body"}}" style=" {{#each bodyStyle}} {{xkey}}:{{.}}; {{/each}} " id="ks-stdmod-body-{{id}}">{{{bodyContent}}}</div> <div class="{{getBaseCssClasses "footer"}}" style=" {{#each footerStyle}} {{xkey}}:{{.}}; {{/each}} " id="ks-stdmod-footer-{{id}}">{{{footerContent}}}</div> </div> <div tabindex="0" style="position: absolute"></div>'});
KISSY.add("overlay/dialog-render",function(e,d,c,a){return d.extend({initializer:function(){e.mix(this.get("elAttrs"),{role:"dialog","aria-labelledby":"ks-stdmod-header"+this.get("id")});e.mix(this.get("childrenElSelectors"),{header:"#ks-stdmod-header-{id}",body:"#ks-stdmod-body-{id}",footer:"#ks-stdmod-footer-{id}"})},getChildrenContainerEl:function(){return this.get("body")},_onSetBodyStyle:function(a){this.get("body").css(a)},_onSetHeaderStyle:function(a){this.get("header").css(a)},_onSetFooterStyle:function(a){this.get("footer").css(a)},
_onSetBodyContent:function(a){var c;c=this.get("body");c.html(a)},_onSetHeaderContent:function(a){var c;c=this.get("header");c.html(a)},_onSetFooterContent:function(a){var c;c=this.get("footer");c.html(a)}},{ATTRS:{closable:{value:!1},contentTpl:{value:a+c},headerContent:{sync:0},bodyContent:{sync:0},footerContent:{sync:0},headerStyle:{sync:0},bodyStyle:{sync:0},footerStyle:{sync:0},body:{},header:{},footer:{}},HTML_PARSER:{header:function(a){return a.one("."+this.getBaseCssClass("header"))},body:function(a){return a.one("."+
this.getBaseCssClass("body"))},footer:function(a){return a.one("."+this.getBaseCssClass("footer"))},headerContent:function(a){return a.one("."+this.getBaseCssClass("header")).html()},bodyContent:function(a){return a.one("."+this.getBaseCssClass("body")).html()},footerContent:function(a){return(a=a.one("."+this.getBaseCssClass("footer")))&&a.html()}}})},{requires:["./overlay-render","./dialog-tpl","./close-tpl"]});
KISSY.add("overlay/dialog",function(e,d,c,a){var b=d.extend({__afterCreateEffectGhost:function(a){var b=this.get("body");a.all("."+this.prefixCls+"stdmod-body").css({height:b.height(),width:b.width()}).html("");return a},handleKeyEventInternal:function(b){if(this.get("escapeToClose")&&b.keyCode===a.KeyCode.ESC){if("select"!=b.target.nodeName.toLowerCase()||b.target.disabled)this.close(),b.halt()}else a:if(b.keyCode==f){var c=this.get("el"),e=a.all(b.target),d=c.last();if(e.equals(c)&&b.shiftKey)d[0].focus(),
b.halt();else if(e.equals(d)&&!b.shiftKey)this.focus(),b.halt();else if(e.equals(c)||c.contains(e))break a;b.halt()}},_onSetVisible:function(a){var c=this.get("el");if(a)this.__lastActive=c[0].ownerDocument.activeElement,this.set("focused",!0),c.attr("aria-hidden","false");else{c.attr("aria-hidden","true");try{this.__lastActive&&this.__lastActive.focus()}catch(e){}}b.superclass._onSetVisible.apply(this,arguments)}},{ATTRS:{header:{view:1},body:{view:1},footer:{view:1},bodyStyle:{value:{},view:1},
footerStyle:{value:{},view:1},headerStyle:{value:{},view:1},headerContent:{value:"",view:1},bodyContent:{value:"",view:1},footerContent:{value:"",view:1},closable:{value:!0},xrender:{value:c},focusable:{value:!0},escapeToClose:{value:!0}}},{xclass:"dialog"}),f=a.KeyCode.TAB;return b},{requires:["./base","./dialog-render","node"]});
KISSY.add("overlay/popup",function(e,d,c){return d.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,b=a.get("trigger"),d;a.__mouseEnterPopup=function(b){a._clearHiddenTimer();d=e.later(function(){a._showing(b);d=c},1E3*a.get("mouseDelay"))};b.on("mouseenter",a.__mouseEnterPopup);a._mouseLeavePopup=function(){d&&
(d.cancel(),d=c);a._setHiddenTimer()};b.on("mouseleave",a._mouseLeavePopup)},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=e.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=c)},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();if(a.get("toggle"))a[a.get("visible")?
"_hiding":"_showing"](b);else a._showing(b)};a.get("trigger").on("click",a.__clickPopup)},_showing:function(a){this.set("currentTrigger",e.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",c);this.hide()},destructor:function(){var a,b=this.get("trigger");b&&(this.__clickPopup&&b.detach("click",this.__clickPopup),this.__mouseEnterPopup&&b.detach("mouseenter",this.__mouseEnterPopup),this._mouseLeavePopup&&b.detach("mouseleave",this._mouseLeavePopup));(a=this.get("el"))&&a.detach("mouseleave",
this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,this)}},{ATTRS:{trigger:{setter:function(a){return e.all(a)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup"})},{requires:["./base"]});KISSY.add("overlay",function(e,d,c,a,b,f){d.Render=c;a.Render=b;d.Dialog=a;e.Dialog=a;d.Popup=f;return e.Overlay=d},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
