/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 7 13:53
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/gesture",function(f,b){var c=b.Gesture,e=f.Features,a,h,i,k;e.isTouchEventSupported()?(a="touchstart",h="touchmove",k="touchend",i="touchcancel"):e.isMsPointerSupported()&&(a="MSPointerDown",h="MSPointerMove",k="MSPointerUp",i="MSPointerCancel");a&&(c.start=a,c.move=h,c.end=k,c.cancel=i,c.tap="tap",c.doubleTap="doubleTap");return c},{requires:["event/dom/base"]});
KISSY.add("event/dom/touch/single-touch",function(f){function b(){}b.prototype={constructor:b,requiredTouchCount:1,onTouchStart:function(c){if(c.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=c.touches},onTouchMove:f.noop,onTouchEnd:f.noop};return b});
KISSY.add("event/dom/touch/tap",function(f,b,c,e){function a(){}f.extend(a,e,{onTouchMove:function(){return!1},onTouchEnd:function(a){c.fire(a.target,"tap",{touch:a.changedTouches[0]})}});b.tap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(f,b,c,e){function a(d,g,j){var m=g.changedTouches[0],a=m.pageX-d.startX,e=m.pageY-d.startY,b=Math.abs(a),h=Math.abs(e);if(j)d.isVertical&&d.isHorizontal&&(h>b?d.isHorizontal=0:d.isVertical=0);else if(d.isVertical&&h<l&&(d.isVertical=0),d.isHorizontal&&b<l)d.isHorizontal=0;if(d.isHorizontal)a=0>a?"left":"right";else if(d.isVertical)a=0>e?"up":"down",b=h;else return!1;c.fire(g.target,j?k:i,{originalEvent:g.originalEvent,touch:m,direction:a,distance:b,duration:(g.timeStamp-
d.startTime)/1E3})}function h(){}var i="swipe",k="swiping",l=50;f.extend(h,e,{onTouchStart:function(d){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var g=d.touches[0];this.startTime=d.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=g.pageX;this.startY=g.pageY;-1!=d.type.indexOf("mouse")&&d.preventDefault()},onTouchMove:function(d){var g=d.changedTouches[0],j=g.pageY-this.startY,g=Math.abs(g.pageX-this.startX),j=Math.abs(j);if(1E3<d.timeStamp-this.startTime)return!1;this.isVertical&&
35<g&&(this.isVertical=0);this.isHorizontal&&35<j&&(this.isHorizontal=0);return a(this,d,1)},onTouchEnd:function(d){return!1===this.onTouchMove(d)?!1:a(this,d,0)}});b[i]=b[k]={handle:new h};return h},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(f,b,c,e){function a(){}f.extend(a,e,{onTouchStart:function(b){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=b.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var b=this.lastEndTime,e=a.timeStamp,f=a.target,d=a.changedTouches[0],g=e-this.startTime;this.lastEndTime=e;if(b&&(g=e-b,300>g)){this.lastEndTime=0;c.fire(f,"doubleTap",
{touch:d,duration:g/1E3});return}g=e-this.startTime;300<g?c.fire(f,"singleTap",{touch:d,duration:g/1E3}):this.singleTapTimer=setTimeout(function(){c.fire(f,"singleTap",{touch:d,duration:g/1E3})},300)}});b.singleTap=b.doubleTap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(f,b){function c(){}c.prototype={constructor:c,requiredTouchCount:2,onTouchStart:function(b){var a=this.requiredTouchCount,c=b.touches.length;c===a?this.start():c>a&&this.end(b)},onTouchEnd:function(b){this.end(b)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(e){var a=e.touches,e=a[0].target,a=a[1].target;if(e==a||b.contains(e,a))return e;for(;;){if(b.contains(a,e))return a;a=a.parentNode}},
end:function(b){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(b)))}};return c},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(f,b,c,e,a){function h(){}function i(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}f.extend(h,e,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,d,g=b[0],j=b[1];d=g.pageX-j.pageX;g=g.pageY-j.pageY;d=Math.sqrt(d*d+g*g);this.lastTouches=b;this.isStarted?c.fire(this.target,"pinch",f.mix(a,{distance:d,scale:d/this.startDistance})):(this.isStarted=!0,this.startDistance=d,b=this.target=this.getCommonTarget(a),c.fire(b,"pinchStart",f.mix(a,
{distance:d,scale:1})))}},fireEnd:function(a){c.fire(this.target,"pinchEnd",f.mix(a,{touches:this.lastTouches}))}});e=new h;b.pinchStart=b.pinchEnd={handle:e};b.pinch={handle:e,add:function(){c.on(this,a.move,i)},remove:function(){c.detach(this,a.move,i)}};return h},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(f,b,c,e,a){function h(){}function i(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}f.extend(h,c,{onTouchStart:function(a){if(!1===h.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){e.fire(a.target,"tapHold",{touch:a.touches[0],duration:(f.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold={setup:function(){e.on(this,
a.start,i)},tearDown:function(){e.detach(this,a.start,i)},handle:new h};return h},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(f,b,c,e,a,h){function i(){}function k(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}var l=180/Math.PI;f.extend(i,c,{onTouchMove:function(a){if(this.isTracking){var g=a.touches,j=g[0],b=g[1],c=this.lastAngle,j=Math.atan2(b.pageY-j.pageY,b.pageX-j.pageX)*l;if(c!==h){var b=Math.abs(j-c),i=(j+360)%360,k=(j-360)%360;Math.abs(i-c)<b?j=i:Math.abs(k-c)<b&&(j=k)}this.lastTouches=g;this.lastAngle=j;this.isStarted?e.fire(this.target,"rotate",f.mix(a,{angle:j,
rotation:j-this.startAngle})):(this.isStarted=!0,this.startAngle=j,this.target=this.getCommonTarget(a),e.fire(this.target,"rotateStart",f.mix(a,{angle:j,rotation:0})))}},end:function(){this.lastAngle=h;i.superclass.end.apply(this,arguments)},fireEnd:function(a){e.fire(this.target,"rotateEnd",f.mix(a,{touches:this.lastTouches}))}});c=new i;b.rotateEnd=b.rotateStart={handle:c};b.rotate={handle:c,add:function(){e.on(this,a.move,k)},remove:function(){e.detach(this,a.move,k)}};return i},{requires:["./handle-map",
"./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch-start",function(f,b,c,e){function a(){}f.extend(a,e,{onTouchStart:function(b){if(!1!==a.superclass.onTouchStart.apply(this,arguments))c.fire(b.target,"singleTouchStart",{touch:b.touches[0],touches:b.touches});else return!1}});b.singleTouchStart={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/handle",function(f,b,c,e,a){function h(a){this.doc=a;this.eventHandle={};this.init();this.touches=[]}var i=f.guid("touch-handle"),k=f.Features,l=k.isMsPointerSupported(),d={};d[a.start]="onTouchStart";d[a.move]="onTouchMove";d[a.end]="onTouchEnd";a.cancel&&(d[a.cancel]="onTouchEnd");h.prototype={constructor:h,addTouch:function(a){this.touches.push(a)},removeTouch:function(a){var b=this.touches;f.each(b,function(c,d){if(c.pointerId==a.pointerId)return b.splice(d,1),!1})},
updateTouch:function(a){var b=this.touches;f.each(b,function(c,d){if(c.pointerId==a.pointerId)return b[d]=a,!1})},init:function(){var a=this.doc,b,c;for(b in d)c=d[b],e.on(a,b,this[c],this)},normalize:function(a){var b=a.type,c;if(k.isTouchEventSupported())return c="touchend"==b||"touchcancel"==b?a.changedTouches:a.touches,1==c.length&&(a.which=1,a.pageX=c.pageX,a.pageY=c.pageY),a;if(l)c=this.touches;else{if(-1!=b.indexOf("mouse")&&1!=a.which)return;c=[a]}b=!b.match(/(up|cancel)$/i);a.touches=b?c:
[];a.targetTouches=b?c:[];a.changedTouches=c;return a},onTouchMove:function(a){l&&this.updateTouch(a.originalEvent);this.callEventHandle("onTouchMove",a)},onTouchStart:function(a){var b,c,d=this.eventHandle;for(b in d)c=d[b].handle,c.isActive=1;l&&this.addTouch(a.originalEvent);this.callEventHandle("onTouchStart",a)},onTouchEnd:function(a){this.callEventHandle("onTouchEnd",a);l&&this.removeTouch(a.originalEvent)},callEventHandle:function(a,b){var c=this.eventHandle,d,e;if(b=this.normalize(b)){for(d in c)e=
c[d].handle,e.processed||(e.processed=1,e.isActive&&!1===e[a](b)&&(e.isActive=0));for(d in c)e=c[d].handle,e.processed=0}},addEventHandle:function(a){var b=this.eventHandle,d=c[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:d}},removeEventHandle:function(a){var b=this.eventHandle;b[a]&&(b[a].count--,b[a].count||delete b[a])},destroy:function(){var a=this.doc,b,c;for(b in d)c=d[b],e.detach(a,b,this[c],this)}};return{addDocumentHandle:function(a,c){var d=b.getWindow(a.ownerDocument||a).document,e=
b.data(d,i);e||b.data(d,i,e=new h(d));e.addEventHandle(c)},removeDocumentHandle:function(a,c){var d=b.getWindow(a.ownerDocument||a).document,e=b.data(d,i);e&&(e.removeEventHandle(c),f.isEmptyObject(e.eventHandle)&&(e.destroy(),b.removeData(d,i)))}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate,./single-touch-start".split(",")});
KISSY.add("event/dom/touch",function(f,b,c,e){function a(a){h.call(this,a);c[a].setup.apply(this,arguments)}function h(a){var b=this.style;l.isMsPointerSupported()&&b&&(this.__ks_touch_action||(this.__ks_touch_action=b.msTouchAction,this.__ks_user_select=b.msUserSelect,b.msTouchAction=b.msUserSelect="none"),this.__ks_touch_action_count?this.__ks_touch_action_count++:this.__ks_touch_action_count=1);e.addDocumentHandle(this,a)}function i(a){k.call(this,a);c[a].tearDown.apply(this,arguments)}function k(a){var b=
this.style;l.isMsPointerSupported()&&b&&(this.__ks_touch_action_count--,this.__ks_touch_action_count||(b.msUserSelect=this.__ks_user_select,b.msTouchAction=this.__ks_touch_action,this.__ks_touch_action=""));e.removeDocumentHandle(this,a)}var l=f.Features,f=b._Special,d,g;for(d in c)b={},g=c[d],b.setup=g.setup?a:h,b.tearDown=g.tearDown?i:k,g.add&&(b.add=g.add),g.remove&&(b.remove=g.remove),f[d]=b},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
