/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 7 13:55
*/
KISSY.add("tree/node-tpl",function(){return'<div id="ks-tree-node-row-{{id}}" class="{{getBaseCssClasses "row"}} {{#if selected}} {{getBaseCssClasses "selected"}} {{/if}} "> <div id="ks-tree-node-expand-icon-{{id}}" class="{{getBaseCssClasses "expand-icon"}}"> </div> {{#if checkable}} <div id="ks-tree-node-checked-{{id}}" class="{{getBaseCssClasses "checked"+checkState}}"></div> {{/if}} <div id="ks-tree-node-icon-{{id}}" class="{{getBaseCssClasses "icon"}}"> </div> <span id="ks-content-{{id}}" class="{{getBaseCssClasses "content"}}">{{{content}}}</span> </div> <div id="ks-tree-node-children-{{id}}" class="{{getBaseCssClasses "children"}}" {{#if expanded}} {{else}} style="display:none" {{/if}} > </div>'});
KISSY.add("tree/node-render",function(c,b,f,h,g){return f.Render.extend([g.ContentRender],{initializer:function(){var a=this.get("renderData");c.mix(this.get("elAttrs"),{role:"tree-node","aria-labelledby":"ks-content"+a.id,"aria-expanded":a.expanded?"true":"false","aria-selected":a.selected?"true":"false","aria-level":a.depth,title:a.tooltip});c.mix(this.get("childrenElSelectors"),{expandIconEl:"#ks-tree-node-expand-icon-{id}",rowEl:"#ks-tree-node-row-{id}",iconEl:"#ks-tree-node-icon-{id}",childrenEl:"#ks-tree-node-children-{id}",
checkIconEl:"#ks-tree-node-checked-{id}"})},refreshCss:function(a,b){var g=this.get("iconEl"),f,i,h=this.get("expandIconEl"),l=this.get("childrenEl");b?(f="file-icon",i="expand-icon-{t}"):this.get("expanded")?(f="expanded-folder-icon",i="expand-icon-{t}minus"):(f="collapsed-folder-icon",i="expand-icon-{t}plus");g[0].className=this.getBaseCssClasses(f);h[0].className=this.getBaseCssClasses(c.substitute(i,{t:a?"l":"t"}));l[0].className=this.getBaseCssClasses(a?"lchildren":"children")},_onSetExpanded:function(a){this.get("childrenEl")[a?
"show":"hide"]();this.get("el").attr("aria-expanded",a)},_onSetSelected:function(a){this.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClass("selected"));this.get("el").attr("aria-selected",a)},_onSetDepth:function(a){this.get("el")[0].setAttribute("aria-level",a)},_onSetCheckState:function(a){this.get("checkIconEl").removeClass(this.getBaseCssClass("checked0 checked1 checked2")).addClass(this.getBaseCssClass("checked")+a)},getChildrenContainerEl:function(){return this.get("childrenEl")}},
{ATTRS:{contentTpl:{value:h},childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},expanded:{sync:0},rowEl:{},depth:{sync:0},isLeaf:{},selected:{sync:0},checkIconEl:{},checkable:{},checkState:{sync:0}},HTML_PARSER:{rowEl:function(a){return a.one("."+this.getBaseCssClass("row"))},childrenEl:function(a){return a.one("."+this.getBaseCssClass("children"))},isLeaf:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1},expanded:function(a){return"none"!=
a.one("."+this.getBaseCssClass("children")).css("display")},expandIconEl:function(a){return a.one("."+this.getBaseCssClass("expand-icon"))},checkState:function(a){if(a=a.one("."+this.getBaseCssClass("checked")))for(var b="checked0 checked1 checked2".split(/\s+/),c=0;c<b.length;c++)if(a.hasClass(this.getBaseCssClass(b[c])))return c;return 0},iconEl:function(a){return a.one("."+this.getBaseCssClass("icon"))},checkIconEl:function(a){return a.one("."+this.getBaseCssClass("checked"))}}})},{requires:["node",
"component/base","./node-tpl","component/extension"]});
KISSY.add("tree/node",function(c,b,f,h,g){function a(e){e.target==this&&d(this,e.component,this.get("depth"),e.index)}function o(e){e.target==this&&(m(this.get("tree"),e.component,"_unRegister"),q(this,e.index))}function p(e){e.target===this&&this.get("el")[0].setAttribute("aria-setsize",this.get("children").length)}function j(e){var a=e.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||a==e}function i(e){var a=e.get("isLeaf");return!(!1===a||void 0===a&&e.get("children").length)}
function k(e){var a=e.get("children");return!e.get("expanded")||!a.length?e:k(a[a.length-1])}function l(e){e.get&&e.get("view")&&e.get("view").refreshCss(j(e),i(e))}function d(e,a,d,c){var b=e.get("tree");b&&(m(b,a,"_register",d+1),q(e,c))}function m(e,a,d,b){e[d](a);void 0!==b&&a.set("depth",b);c.each(a.get("children"),function(a){"number"==typeof b?m(e,a,d,b+1):m(e,a,d)})}function q(a,d){l(a);for(var d=Math.max(0,d-1),b=a.get("children"),c,g=b.length;d<g;d++)c=b[d],l(c),c.get("el")[0].setAttribute("aria-posinset",
d+1)}var s=b.all,n=b.KeyCode,r=f.Controller.extend([h.DecorateChild],{bindUI:function(){this.on("afterAddChild",a);this.on("afterRemoveChild",o);this.on("afterAddChild afterRemoveChild",p)},syncUI:function(){l(this);p.call(this,{target:this})},_keyNav:function(a){var d=!0,b=this.get("tree"),c=this.get("expanded"),g,f=this.get("isLeaf"),m=this.get("children");switch(a.keyCode){case n.HOME:g=b;break;case n.END:g=k(b);break;case n.UP:g=a=(a=this.prev())?k(a):this.get("parent");break;case n.DOWN:a=this.get("children");
if(this.get("expanded")&&a.length)g=a[0];else{a=this.next();for(b=this;!a&&(b=b.get("parent"));)a=b.next();g=a}break;case n.LEFT:c&&(m.length||!1===f)?this.set("expanded",!1):g=this.get("parent");break;case n.RIGHT:if(m.length||!1===f)c?g=m[0]:this.set("expanded",!0);break;default:d=!1}g&&g.select();return d},next:function(){var a=this.get("parent"),d;if(!a)return null;a=a.get("children");d=c.indexOf(this,a);return d==a.length-1?null:a[d+1]},prev:function(){var a=this.get("parent"),d;if(!a)return null;
a=a.get("children");d=c.indexOf(this,a);return 0===d?null:a[d-1]},select:function(){this.set("selected",!0)},performActionInternal:function(a){var a=s(a.target),d=this.get("expanded");this.get("tree").focus();a.equals(this.get("expandIconEl"))?this.set("expanded",!d):(this.select(),this.fire("click"))},renderChildren:function(){r.superclass.renderChildren.apply(this,arguments);this===this.get("tree")&&d(this,this,-1,0)},_onSetExpanded:function(a){l(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,
d){var b=this.get("tree");if(!d||!d.byPassSetTreeSelectedItem)b.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);c.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);c.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{xrender:{value:g},handleMouseEvents:{value:!1},isLeaf:{view:1},contentEl:{view:1},expandIconEl:{view:1},iconEl:{view:1},selected:{view:1},expanded:{sync:0,value:!1,view:1},tooltip:{view:1},
tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},decorateChildCls:{valueFn:function(){return this.getBaseCssClass("children")}},defaultChildCfg:{value:{xclass:"tree-node"}}}},{xclass:"tree-node"});return r},{requires:["node","component/base","component/extension","./node-render"]});
KISSY.add("tree/tree-manager-render",function(c){function b(){this.get("elAttrs").role="tree"}b.ATTRS={showRootNode:{}};c.augment(b,{_onSetShowRootNode:function(b){this.get("rowEl")[b?"show":"hide"]()}});return b});KISSY.add("tree/tree-render",function(c,b,f){return b.extend([f])},{requires:["./node-render","./tree-manager-render"]});
KISSY.add("tree/tree-manager",function(c,b,f,h){function g(){}function a(a){var a=a.get("el"),b=a.attr("id");b||a.attr("id",b=c.guid("tree-node"));return b}function o(a){a._allNodes||(a._allNodes={});return a._allNodes}var p=b.KeyCode,j=c.UA,i=c.Env.host.document.documentMode||j.ie,k=b.Gesture,l=c.Features.isTouchEventSupported();g.ATTRS={showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0}};c.augment(g,h.DelegateChildren,{isTree:1,__bindUI:function(){var a=k.start+" "+k.end+" "+k.tap;
k.cancel&&(a+=" "+k.cancel);l||(a+=i&&9>i?"dblclick ":"");this.get("el").on(a,this.handleChildrenEvents,this)},_register:function(d){d.__isRegisted||(o(this)[a(d)]=d,d.__isRegisted=1)},_unRegister:function(d){d.__isRegisted&&(delete o(this)[a(d)],d.__isRegisted=0)},handleKeyEventInternal:function(a){var b=this.get("selectedItem");return a.keyCode==p.ENTER?b.performActionInternal(a):b._keyNav(a)},getOwnerControl:function(a){for(var a=a.target,b,c=o(this),g=this.get("el")[0];a&&a!==g;){if(b=c[a.id])return b;
a=a.parentNode}return this},_onSetSelectedItem:function(a,b){a&&b.prevVal&&b.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetFocused:function(a){f.Controller.prototype._onSetFocused.apply(this,arguments);a&&!this.get("selectedItem")&&this.select()}});return g},{requires:["node","component/base","component/extension"]});
KISSY.add("tree/base",function(c,b,f,h,g){return f.extend([g],{},{ATTRS:{xrender:{value:h},defaultChildCfg:{value:{xclass:"tree-node"}}}},{xclass:"tree"})},{requires:["component/base","./node","./tree-render","./tree-manager"]});
KISSY.add("tree/check-node",function(c,b,f){var h=b.all,b=f.extend({performActionInternal:function(b){var a;a=this.get("expanded");var c=this.get("expandIconEl"),f=this.get("tree"),b=h(b.target);f.focus();b.equals(c)?this.set("expanded",!a):(a=this.get("checkState"),this.set("checkState",1==a?0:1),this.fire("click"))},_onSetCheckState:function(b){var a=this.get("parent"),f,h,j,i;(1==b||0==b)&&c.each(this.get("children"),function(a){a.set("checkState",b)});if(a){f=0;i=a.get("children");for(h=0;h<i.length;h++){j=
i[h];j=j.get("checkState");if(2==j){a.set("checkState",2);return}1==j&&f++}0===f?a.set("checkState",0):f==i.length?a.set("checkState",1):a.set("checkState",2)}}},{ATTRS:{checkIconEl:{view:1},checkable:{value:!0,view:1},checkState:{value:0,sync:0,view:1},defaultChildCfg:{value:{xclass:"check-tree-node"}}}},{xclass:"check-tree-node"});c.mix(b,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});return b},{requires:["node","./node"]});
KISSY.add("tree/check-tree",function(c,b,f,h,g){return f.extend([g],{},{ATTRS:{xrender:{value:h},defaultChildCfg:{value:{xclass:"check-tree-node"}}}},{xclass:"check-tree"})},{requires:["component/base","./check-node","./tree-render","./tree-manager"]});KISSY.add("tree",function(c,b,f,h,g){b.Node=f;b.CheckNode=h;b.CheckTree=g;return b},{requires:["tree/base","tree/node","tree/check-node","tree/check-tree"]});
