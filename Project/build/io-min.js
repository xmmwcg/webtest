/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 7 13:53
*/
KISSY.add("io/form-serializer",function(d,g){function j(a){return a.replace(i,"\r\n")}var k=/^(?:select|textarea)/i,i=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,f){return d.param(c.getFormData(a),void 0,void 0,f||!1)},getFormData:function(b){var f=[],c={};d.each(g.query(b),function(a){a=a.elements?d.makeArray(a.elements):[a];f.push.apply(f,a)});f=d.filter(f,function(n){return n.name&&!n.disabled&&
(n.checked||k.test(n.nodeName)||a.test(n.type))});d.each(f,function(a){var e=g.val(a),h;null!==e&&(e=d.isArray(e)?d.map(e,j):j(e),(h=c[a.name])?(h&&!d.isArray(h)&&(h=c[a.name]=[h]),h.push.apply(h,d.makeArray(e))):c[a.name]=e)});return c}}},{requires:["dom"]});
KISSY.add("io/base",function(d,g,j,k){function i(a){var h=a.context;delete a.context;a=d.mix(d.clone(l),a,{deep:!0});a.context=h||a;var b,c=a.type,m=a.dataType,h=a.uri=e.resolve(a.url);a.uri.setQuery("");"crossDomain"in a||(a.crossDomain=!a.uri.isSameOriginAs(e));c=a.type=c.toUpperCase();a.hasContent=!n.test(c);if(a.processData&&(b=a.data)&&"string"!=typeof b)a.data=d.param(b,k,k,a.serializeArray);m=a.dataType=d.trim(m||"*").split(f);!("cache"in a)&&d.inArray(m[0],["script","jsonp"])&&(a.cache=!1);
a.hasContent||(a.data&&h.query.add(d.unparam(a.data)),!1===a.cache&&h.query.set("_ksTS",d.now()+"_"+d.guid()));return a}function c(h,e){a.fire(h,{ajaxConfig:e.config,io:e})}function a(e){function n(a){return function(h){if(g=b.timeoutTimer)clearTimeout(g),b.timeoutTimer=0;var n=e[a];n&&n.apply(r,h);c(a,b)}}var b=this;if(!(b instanceof a))return new a(e);m.call(b);e=i(e);d.mix(b,{responseData:null,config:e||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,
requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new d.Defer(this)});var f;c("start",b);f=new (h[e.dataType[0]]||h["*"])(b);b.transport=f;e.contentType&&b.setRequestHeader("Content-Type",e.contentType);var l=e.dataType[0],g,j,k=e.timeout,r=e.context,q=e.headers,x=e.accepts;b.setRequestHeader("Accept",l&&x[l]?x[l]+("*"===l?"":", */*; q=0.01"):x["*"]);for(j in q)b.setRequestHeader(j,q[j]);if(e.beforeSend&&!1===e.beforeSend.call(r,b,e))return b;b.done(n("success"),
n("error"));b.fin(n("complete"));b.readyState=1;c("send",b);e.async&&0<k&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*k));try{b.state=1,f.send()}catch(z){2>b.state&&b._ioReady(-1,z.message)}return b}var b=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,f=/\s+/,g=function(a){return a},m=d.Promise,n=/^(?:GET|HEAD)$/,e=new d.Uri((d.Env.host.location||{}).href),b=e&&b.test(e.getScheme()),h={},l={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,
serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:d.parseJSON,html:g,text:g,xml:d.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};l.converters.html=l.converters.text;d.mix(a,j.Target);d.mix(a,{isLocal:b,setupConfig:function(a){d.mix(l,a,{deep:!0})},setupTransport:function(a,e){h[a]=e},getTransport:function(a){return h[a]},getConfig:function(){return l}});return a},
{requires:["json","event"]});
KISSY.add("io/xhr-transport-base",function(d,g){function j(a,e){try{return new (e||i).XMLHttpRequest}catch(b){}}function k(a){var e;a.ifModified&&(e=a.uri,!1===a.cache&&(e=e.clone(),e.query.remove("_ksTS")),e=e.toString());return e}var i=d.Env.host,c=7<d.UA.ie&&i.XDomainRequest,a={proto:{}},b={},f={};g.__lastModifiedCached=b;g.__eTagCached=f;a.nativeXhr=i.ActiveXObject?function(a,e){var b;if(!m&&a&&c)b=new c;else if(!(b=!g.isLocal&&j(a,e)))a:{try{b=new (e||i).ActiveXObject("Microsoft.XMLHTTP");break a}catch(f){}b=
void 0}return b}:j;a._XDomainRequest=c;var m=a.supportCORS="withCredentials"in a.nativeXhr();d.mix(a.proto,{sendInternal:function(){var a=this,e=a.io,h=e.config,l=a.nativeXhr,g=h.files,j=g?"post":h.type,i=h.async,o,u=e.mimeType,p=e.requestHeaders||{},e=e._getUrlForSend(),v=k(h),s,r;if(v){if(s=b[v])p["If-Modified-Since"]=s;if(s=f[v])p["If-None-Match"]=s}(o=h.username)?l.open(j,e,i,o,h.password):l.open(j,e,i);j=h.xhrFields||{};"withCredentials"in j?m||delete j.withCredentials:m&&(j.withCredentials=
!0);for(r in j)l[r]=j[r];u&&l.overrideMimeType&&l.overrideMimeType(u);p["X-Requested-With"]||(p["X-Requested-With"]="XMLHttpRequest");if("undefined"!==typeof l.setRequestHeader)for(r in p)l.setRequestHeader(r,p[r]);var q=h.hasContent&&h.data||null;g&&(u=q,p={},u&&(p=d.unparam(u)),p=d.mix(p,g),q=new FormData,d.each(p,function(a,b){d.isArray(a)?d.each(a,function(a){q.append(b+(h.serializeArray?"[]":""),a)}):q.append(b,a)}));l.send(q);!i||4==l.readyState?a._callback():c&&l instanceof c?(l.onload=function(){l.readyState=
4;l.status=200;a._callback()},l.onerror=function(){l.readyState=4;l.status=500;a._callback()}):l.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,e){var h=this.nativeXhr,m=this.io,j,i,w,o,u,p=m.config;try{if(e||4==h.readyState)if(c&&h instanceof c?(h.onerror=d.noop,h.onload=d.noop):h.onreadystatechange=d.noop,e)4!==h.readyState&&h.abort();else{j=k(p);var v=h.status;c&&h instanceof c||(m.responseHeadersString=h.getAllResponseHeaders());j&&(i=
h.getResponseHeader("Last-Modified"),w=h.getResponseHeader("ETag"),i&&(b[j]=i),w&&(f[w]=w));if((u=h.responseXML)&&u.documentElement)m.responseXML=u;var s=m.responseText=h.responseText;if(p.files&&s){var r,q;if(-1!=(r=s.indexOf("<body>")))q=s.lastIndexOf("</body>"),-1==q&&(q=s.length),s=s.slice(r+6,q);m.responseText=d.unEscapeHTML(s)}try{o=h.statusText}catch(x){o=""}!v&&g.isLocal&&!p.crossDomain?v=m.responseText?200:404:1223===v&&(v=204);m._ioReady(v,o)}}catch(z){h.onreadystatechange=d.noop,e||m._ioReady(-1,
z)}}});return a},{requires:["./base"]});
KISSY.add("io/sub-domain-transport",function(d,g,j,k){function i(a){var b=a.config;this.io=a;b.crossDomain=!1}function c(){var a=this.io.config.uri.getHostname(),a=b[a];a.ready=1;j.detach(a.iframe,"load",c,this);this.send()}var a=d.Env.host.document,b={};d.augment(i,g.proto,{send:function(){var f=this.io.config,m=f.uri,n=m.getHostname(),e;e=b[n];var h="/sub_domain_proxy.html";f.xdr&&f.xdr.subDomain&&f.xdr.subDomain.proxy&&(h=f.xdr.subDomain.proxy);e&&e.ready?(this.nativeXhr=g.nativeXhr(0,e.iframe.contentWindow))&&
this.sendInternal():(e?f=e.iframe:(e=b[n]={},f=e.iframe=a.createElement("iframe"),k.css(f,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(f,a.body||a.documentElement),e=new d.Uri,e.setScheme(m.getScheme()),e.setPort(m.getPort()),e.setHostname(n),e.setPath(h),f.src=e.toString()),j.on(f,"load",c,this))}});return i},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xdr-flash-transport",function(d,g,j){function k(b,e,h){m||(m=!0,b='<object id="'+a+'" type="application/x-shockwave-flash" data="'+b+'" width="0" height="0"><param name="movie" value="'+b+'" /><param name="FlashVars" value="yid='+e+"&uid="+h+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',e=f.createElement("div"),j.prepend(e,f.body||f.documentElement),e.innerHTML=b)}function i(a){this.io=a}var c={},a="io_swf",b,f=d.Env.host.document,m=!1;d.augment(i,{send:function(){var a=
this,e=a.io,h=e.config;k((h.xdr||{}).src||d.Config.base+"io/assets/io.swf",1,1);b?(a._uid=d.guid(),c[a._uid]=a,b.send(e._getUrlForSend(),{id:a._uid,uid:a._uid,method:h.type,data:h.hasContent&&h.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){b.abort(this._uid)},_xdrResponse:function(a,b){var h,d=b.id,f,m=b.c,g=this.io;if(m&&(f=m.responseText))g.responseText=decodeURI(f);switch(a){case "success":h={status:200,statusText:"success"};delete c[d];break;case "abort":delete c[d];break;
case "timeout":case "transport error":case "failure":delete c[d],h={status:"status"in m?m.status:500,statusText:m.statusText||a}}h&&g._ioReady(h.status,h.statusText)}});g.applyTo=function(a,b,h){var a=b.split(".").slice(1),f=g;d.each(a,function(a){f=f[a]});f.apply(null,h)};g.xdrReady=function(){b=f.getElementById(a)};g.xdrResponse=function(a,b){var h=c[b.uid];h&&h._xdrResponse(a,b)};return i},{requires:["./base","dom"]});
KISSY.add("io/xhr-transport",function(d,g,j,k,i){function c(f){var c=f.config,g=c.crossDomain,e=c.xdr||{},h=e.subDomain=e.subDomain||{};this.io=f;if(g&&!j.supportCORS){c=c.uri.getHostname();if(a.domain&&d.endsWith(c,a.domain)&&!1!==h.proxy)return new k(f);if("flash"===""+e.use||!b)return new i(f)}this.nativeXhr=j.nativeXhr(g);return this}var a=d.Env.host.document,b=j._XDomainRequest;d.augment(c,j.proto,{send:function(){this.sendInternal()}});g.setupTransport("*",c);return g},{requires:["./base","./xhr-transport-base",
"./sub-domain-transport","./xdr-flash-transport"]});
KISSY.add("io/script-transport",function(d,g,j,k){function i(a){if(!a.config.crossDomain)return new (g.getTransport("*"))(a);this.io=a;return this}var c=d.Env.host,a=c.document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){d.globalEval(a);return a}}}});d.augment(i,{send:function(){var b=this,d,m=b.io,g=m.config,e=a.head||a.getElementsByTagName("head")[0]||
a.documentElement;b.head=e;d=a.createElement("script");b.script=d;d.async=!0;g.scriptCharset&&(d.charset=g.scriptCharset);d.src=m._getUrlForSend();d.onerror=d.onload=d.onreadystatechange=function(a){a=a||c.event;b._callback((a.type||"error").toLowerCase())};e.insertBefore(d,e.firstChild)},_callback:function(a,d){var c=this.script,g=this.io,e=this.head;if(c&&(d||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==a))c.onerror=c.onload=c.onreadystatechange=null,e&&c.parentNode&&e.removeChild(c),
this.head=this.script=k,!d&&"error"!=a?g._ioReady(200,"success"):"error"==a&&g._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",i);return g},{requires:["./base","./xhr-transport"]});
KISSY.add("io/jsonp",function(d,g){var j=d.Env.host;g.setupConfig({jsonp:"callback",jsonpCallback:function(){return d.guid("jsonp")}});g.on("start",function(g){var i=g.io,c=i.config,g=c.dataType;if("jsonp"==g[0]){var a,b=c.jsonpCallback,f=d.isFunction(b)?b():b,m=j[f];c.uri.query.set(c.jsonp,f);j[f]=function(b){1<arguments.length&&(b=d.makeArray(arguments));a=[b]};i.fin(function(){j[f]=m;if(void 0===m)try{delete j[f]}catch(b){}else a&&m(a[0])});i=c.converters;i.script=i.script||{};i.script.json=function(){return a[0]};
g.length=2;g[0]="script";g[1]="json"}});return g},{requires:["./base"]});
KISSY.add("io/form",function(d,g,j,k){var i=Array.prototype.slice,c=d.Env.host.FormData;g.on("start",function(a){var b,f,a=a.io.config;if(f=a.form){b=j.get(f);f=a.data;for(var g=!1,n={},e=j.query("input",b),h=0,l=e.length;h<l;h++){var y=e[h];if("file"==y.type.toLowerCase()){g=!0;if(!c)break;var t=i.call(y.files,0);n[j.attr(y,"name")]=1<t.length?t:t[0]||null}}g&&c&&(a.files=a.files||{},d.mix(a.files,n),delete a.contentType);!g||c?(b=k.getFormData(b),a.hasContent?(b=d.param(b,void 0,void 0,a.serializeArray),
a.data=f?a.data+("&"+b):b):a.uri.query.add(b)):(f=a.dataType,a=f[0],"*"==a&&(a="text"),f.length=2,f[0]="iframe",f[1]=a)}});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("io/iframe-transport",function(d,g,j,k){function i(a){var c=d.guid("io-iframe"),e=g.getEmptyIframeSrc(),a=a.iframe=g.create("<iframe "+(e?' src="'+e+'" ':"")+' id="'+c+'" name="'+c+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(a,b.body||b.documentElement);return a}function c(a,c,e){var h=[],f,j,i,k;d.each(a,function(a,m){f=d.isArray(a);j=d.makeArray(a);for(i=0;i<j.length;i++)k=b.createElement("input"),k.type="hidden",k.name=m+(f&&e?"[]":""),k.value=j[i],g.append(k,
c),h.push(k)});return h}function a(a){this.io=a}var b=d.Env.host.document,f=d.clone(k.getConfig().converters.text);f.json=function(a){return d.parseJSON(d.unEscapeHTML(a))};k.setupConfig({converters:{iframe:f,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});d.augment(a,{send:function(){function a(){j.on(k,"load error",b._callback,b);o.submit()}var b=this,e=b.io,h=e.config,f,k,t,w=h.data,o=g.get(h.form);b.attrs={target:g.attr(o,"target")||"",action:g.attr(o,"action")||"",encoding:g.attr(o,
"encoding"),enctype:g.attr(o,"enctype"),method:g.attr(o,"method")};b.form=o;k=i(e);g.attr(o,{target:k.id,action:e._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});w&&(t=d.unparam(w));t&&(f=c(t,o,h.serializeArray));b.fields=f;6==d.UA.ie?setTimeout(a,0):a()},_callback:function(a){var b=this,e=b.form,c=b.io,a=a.type,f,i=c.iframe;if(i)if("abort"==a&&6==d.UA.ie?setTimeout(function(){g.attr(e,b.attrs)},0):g.attr(e,b.attrs),g.remove(this.fields),j.detach(i),setTimeout(function(){g.remove(i)},
30),c.iframe=null,"load"==a)try{if((f=i.contentWindow.document)&&f.body)c.responseText=g.html(f.body),d.startsWith(c.responseText,"<?xml")&&(c.responseText=void 0);c.responseXML=f&&f.XMLDocument?f.XMLDocument:f;f?c._ioReady(200,"success"):c._ioReady(500,"parser error")}catch(k){c._ioReady(500,"parser error")}else"error"==a&&c._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});k.setupTransport("iframe",a);return k},{requires:["dom","event","./base"]});
KISSY.add("io/methods",function(d,g,j){function k(c){var a=c.responseText,b=c.responseXML,f=c.config,g=f.converters,i,e,h=f.contents,l=f.dataType;if(a||b){for(f=c.mimeType||c.getResponseHeader("Content-Type");"*"==l[0];)l.shift();if(!l.length)for(i in h)if(h[i].test(f)){l[0]!=i&&l.unshift(i);break}l[0]=l[0]||"text";for(i=0;i<l.length;i++)if("text"==l[i]&&a!==j){e=a;break}else if("xml"==l[i]&&b!==j){e=b;break}if(!e){var k={text:a,xml:b};d.each(["text","xml"],function(c){var d=l[0];return g[c]&&g[c][d]&&
k[c]?(l.unshift(c),e="text"==c?a:b,!1):j})}}h=l[0];for(f=1;f<l.length;f++){i=l[f];var t=g[h]&&g[h][i];if(!t)throw"no covert for "+h+" => "+i;e=t(e);h=i}c.responseData=e}var i=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;d.extend(g,d.Promise,{setRequestHeader:function(c,a){this.requestHeaders[c]=a;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var a,b;if(2===this.state){if(!(b=this.responseHeaders))for(b=this.responseHeaders={};a=
i.exec(this.responseHeadersString);)b[a[1]]=a[2];a=b[c]}return a===j?null:a},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;return(c=this.transport)?c.nativeXhr:null},_ioReady:function(c,a){if(2!=this.state){this.state=2;this.readyState=4;var b;if(200<=c&&300>c||304==c)if(304==c)a="not modified",b=!0;else try{k(this),a="success",b=!0}catch(d){a=
"parser error"}else 0>c&&(c=0);this.status=c;this.statusText=a;this._defer[b?"resolve":"reject"]([this.responseData,a,this])}},_getUrlForSend:function(){var c=this.config,a=c.uri,b=d.Uri.getComponents(c.url).query||"";return a.toString.call(a,c.serializeArray)+(b?(a.query.has()?"&":"?")+b:b)}})},{requires:["./base"]});
KISSY.add("io",function(d,g,j){function k(c,a,b,f,g){d.isFunction(a)&&(f=b,b=a,a=i);return j({type:g||"get",url:c,data:a,success:b,dataType:f})}var i=void 0;d.mix(j,{serialize:g.serialize,get:k,post:function(c,a,b,f){d.isFunction(a)&&(f=b,b=a,a=i);return k(c,a,b,f,"post")},jsonp:function(c,a,b){d.isFunction(a)&&(b=a,a=i);return k(c,a,b,"jsonp")},getScript:d.getScript,getJSON:function(c,a,b){d.isFunction(a)&&(b=a,a=i);return k(c,a,b,"json")},upload:function(c,a,b,f,g){d.isFunction(b)&&(g=f,f=b,b=i);
return j({url:c,type:"post",dataType:g,form:a,data:b,success:f})}});d.mix(d,{Ajax:j,IO:j,ajax:j,io:j,jsonp:j.jsonp});return j},{requires:"io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(",")});
