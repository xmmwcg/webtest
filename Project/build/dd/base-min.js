/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 7 13:43
*/
KISSY.add("dd/base/ddm",function(f,j,g){function d(){d.superclass.constructor.apply(this,arguments)}function t(b){var a;if(b=l._normalEvent(b))if(b.preventDefault(),a=this.__activeToDrag)a._move(b);else if(a=this.get("activeDrag"))a._move(b),this.__needDropCheck&&r(this,b,a)}function s(b){b.preventDefault();D.call(this,b)}function r(b,a,e){var c=b.get("validDrops"),h=e.get("mode"),d=0,p=0,n=i(e.get("node")),y=o(n);f.each(c,function(b){var c;if(c=b.getNodeFromTarget(a,e.get("dragNode")[0],e.get("node")[0]))if("point"==
h)u(i(c),e.mousePos)&&(c=o(i(c)),d?c<p&&(d=b,p=c):(d=b,p=c));else if("intersect"==h)c=o(v(n,i(c))),c>p&&(p=c,d=b);else if("strict"==h&&(c=o(v(n,i(c))),c==y))return d=b,!1});if((c=b.get("activeDrop"))&&c!=d)c._handleOut(a),e._handleOut(a);b.setInternal("activeDrop",d);d&&(c!=d?d._handleEnter(a):d._handleOver(a))}function k(b){b._shim=(new j('<div style="background-color:red;position:'+(A?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+l.get("dragCursor")+";z-index:"+E+';"></div>')).prependTo(w.body||
w.documentElement).css("opacity",0);k=h;if(A)F.on("resize scroll",B,b);h(b)}function h(b){var a=b.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==c&&(c=b.get("dragCursor"));b._shim.css({cursor:c,display:"block"});A&&B.call(b)}function n(b){var a=b.get("drops");b.setInternal("validDrops",[]);a.length&&f.each(a,function(b){b._active()})}function x(b){var a=b.get("drops");b.setInternal("validDrops",[]);a.length&&f.each(a,function(b){b._deActive()})}function i(b){var a=
b.offset();return{left:a.left,right:a.left+(b.__dd_cached_width||b.outerWidth()),top:a.top,bottom:a.top+(b.__dd_cached_height||b.outerHeight())}}function u(b,a){return b.left<=a.left&&b.right>=a.left&&b.top<=a.top&&b.bottom>=a.top}function o(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function v(b,a){var c=Math.max(b.top,a.top),e=Math.min(b.right,a.right),d=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:e,top:c,bottom:d}}function a(b){b&&(b.__dd_cached_width=
b.outerWidth(),b.__dd_cached_height=b.outerHeight())}var e=f.UA,c=j.all,y=f.Features,p=f.Env.host,w=p.document,q=c(w),F=c(p),A=6===e.ie,E=999999,m=j.Gesture,C=m.move,z=m.end;m.cancel&&(z+=" "+m.cancel);d.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var D=e.ie&&8>e.ie?f.throttle(t,30):t,B=f.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:q.width(),height:q.height()})},
30);f.extend(d,g,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){var a=this.get("drops"),b=f.indexOf(b,a);-1!=b&&a.splice(b,1)},_regToDrag:function(b){this.__activeToDrag=b;q.on(z,this._end,this);if(m.cancel)q.on(m.cancel,this._end,this);q.on(C,s,this);6===e.ie&&w.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.setInternal("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&k(this);this.__needDropCheck=0;b.get("groups")&&
(n(this),this.get("validDrops").length&&(a(b.get("node")),this.__needDropCheck=1))},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(b){var a=this.__activeToDrag,c=this.get("activeDrag"),d=this.get("activeDrop"),b=l._normalEvent(b);a&&a._move(b);c&&c._move(b);q.detach(C,s,this);q.detach(z,this._end,this);m.cancel&&q.detach(m.cancel,this._end,this);6===e.ie&&w.body.releaseCapture();a&&(a._end(b),this.__activeToDrag=0);this._shim&&this._shim.hide();c&&(c._end(b),x(this),d&&d._end(b),
this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var l=new d;l.inRegion=u;l.region=i;l.area=o;l.cacheWH=a;l.PREFIX_CLS="ks-dd-";l._normalEvent=function(b){var a=""+b.type,a=(a=a==m.end||a==m.cancel?b.changedTouches:b.touches)||[];if((y.isTouchEventSupported()||y.isMsPointerSupported())&&a.length){if(1!=a.length)return;a=a[0];b.target=b.target||a.target;b.currentTarget=b.currentTarget||a.currentTarget;b.pageX=a.pageX;b.pageY=a.pageY}b.which=1;return b};return l},{requires:["node",
"base"]});
KISSY.add("dd/base/draggable",function(f,j,g,d){function t(){return!1}var s=f.UA,r=j.all,k=f.Features,k=k.isTouchEventSupported()||k.isMsPointerSupported(),h=f.each,n=k?"singleTouchStart":j.Gesture.start,x=s.ie,i=d.PREFIX_CLS,u=f.Env.host.document,g=g.extend({initializer:function(){this.addTarget(d);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a);this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(n,v,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("node").detach(n,
v,this).detach("dragstart",this._fixDragStart)},_bufferTimer:null,_onSetDisabledChange:function(a){this.get("dragNode")[a?"addClass":"removeClass"](i+"-disabled")},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var e=this,c=e.get("handlers"),d=0;h(c,function(c){if(c[0]==a||c.contains(a))return d=1,e.setInternal("activeHandler",c),!1});return d},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1!=a.which||this.get("disabled")?0:1},_prepare:function(a){if(a){var e=
this;x&&(o=u.body.onselectstart,u.body.onselectstart=t);e.get("halt")&&a.stopPropagation();a.preventDefault();var c=a.pageX,h=a.pageY;e.setInternal("startMousePos",e.mousePos={left:c,top:h});if(e._allowMove){var f=e.get("node").offset();e.setInternal("startNodePos",f);e.setInternal("deltaPos",{left:c-f.left,top:h-f.top})}d._regToDrag(e);if(c=e.get("bufferTime"))e._bufferTimer=setTimeout(function(){e._start(a)},1E3*c)}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),
this._bufferTimer=0)},_move:function(a){var e=a.pageX,c=a.pageY;if(!this.get("dragging")){var d=this.get("startMousePos"),h=0,f=this.get("clickPixelThresh");if(Math.abs(e-d.left)>=f||Math.abs(c-d.top)>=f)this._start(a),h=1;if(!h)return}this.mousePos={left:e,top:c};a={pageX:e,pageY:c,drag:this};if(d=this._allowMove)h=this.get("deltaPos"),e-=h.left,c-=h.top,a.left=e,a.top=c,this.setInternal("actualPos",{left:e,top:c}),this.fire("dragalign",a);c=1;!1===this.fire("drag",a)&&(c=0);c&&d&&this.get("node").offset(this.get("actualPos"))},
stopDrag:function(){d._end()},_end:function(a){var a=a||{},e;this._clearBufferTimer();x&&(u.body.onselectstart=o);this.get("dragging")&&(this.get("node").removeClass(i+"drag-over"),(e=d.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:e}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this,pageX:a.pageX,pageY:a.pageY}))},_handleOut:function(){this.get("node").removeClass(i+"drag-over");this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},
_handleEnter:function(a){this.get("node").addClass(i+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(a){this._clearBufferTimer();this.setInternal("dragging",1);this.setInternal("dragStartMousePos",{left:a.pageX,top:a.pageY});d._start();this.fire("dragstart",{drag:this,pageX:a.pageX,pageY:a.pageY})},destructor:function(){this.detachDragEvent();this.detach()}},{name:"Draggable",DRAG_START_EVENT:n,ATTRS:{node:{setter:function(a){if(!(a instanceof
j))return r(a)}},clickPixelThresh:{valueFn:function(){return d.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return d.get("bufferTime")}},dragNode:{},shim:{value:!k},handlers:{value:[],getter:function(a){var e=this;a.length||(a[0]=e.get("node"));h(a,function(c,d){f.isFunction(c)&&(c=c.call(e));"string"==typeof c&&(c=e.get("node").one(c));c.nodeType&&(c=r(c));a[d]=c});e.setInternal("handlers",a);return a}},activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?"addClass":
"removeClass"](i+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startMousePos:{},dragStartMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}}});g.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};f.mix(g,g.DropMode);var o,v=function(a){if(a=d._normalEvent(a)){var e=a.target;this._checkDragStartValid(a)&&this._checkHandler(e)&&this._prepare(a)}};return g},{requires:["node","rich-base","./ddm","event"]});
KISSY.add("dd/base/draggable-delegate",function(f,j,g,d){var t=j.PREFIX_CLS,s=d.all,r=g.DRAG_START_EVENT,k=function(d){if(d=j._normalEvent(d)){var f,g;if(this._checkDragStartValid(d)){f=this.get("handlers");var i=s(d.target);(f=f.length?this._getHandler(i):i)&&(g=this._getNode(f));g&&(this.setInternal("activeHandler",f),this.setInternal("node",g),this.setInternal("dragNode",g),this._prepare(d))}}};return g.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},_onSetDisabledChange:function(d){this.get("container")[d?
"addClass":"removeClass"](t+"-disabled")},bindDragEvent:function(){this.get("container").on(r,k,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(r,k,this).detach("dragstart",this._fixDragStart)},_getHandler:function(d){for(var g=void 0,j=this.get("container"),i=this.get("handlers");d&&d[0]!==j[0];){f.each(i,function(f){if(d.test(f))return g=d,!1});if(g)break;d=d.parent()}return g},_getNode:function(d){return d.closest(this.get("selector"),this.get("container"))}},
{ATTRS:{container:{setter:function(d){return s(d)}},selector:{},handlers:{value:[],getter:0}}})},{requires:["./ddm","./draggable","node"]});KISSY.add("dd/base",function(f,j,g,d){f={Draggable:g,DDM:j,DraggableDelegate:d};return KISSY.DD=f},{requires:["./base/ddm","./base/draggable","./base/draggable-delegate"]});
