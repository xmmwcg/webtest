/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 7 13:53
*/
KISSY.add("kison/utils",function(c){var f=/"/g,d=/'/g,h;return{escapeString:h=function(e,a){var b=d;'"'==a?b=f:a="'";return e.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(b,"\\"+a)},serializeObject:function a(b,l){var d;if(l&&c.isFunction(l)&&!1===(d=l(b)))return!1;void 0!==d&&(b=d);d=[];if("string"==typeof b)return"'"+h(b)+"'";if(c.isNumber(b))return b+"";if(c.isRegExp(b))return"/"+b.source+"/"+(b.global?"g":"")+(b.ignoreCase?"i":"")+(b.multiline?"m":
"");if(c.isArray(b)){d.push("[");var f=[];c.each(b,function(b){b=a(b,l);!1!==b&&f.push(b)});d.push(f.join(", "));d.push("]");return d.join("")}if(c.isObject(b)){d=["{"];var p=1,r;for(r in b){var i=b[r];if(!l||!c.isRegExp(l)||!r.match(l))if(i=a(i,l),!1!==i){var s="'"+h(r)+"'";d.push((p?"":",")+s+": "+i);p=0}}d.push("}");return d.join("\n")}return b+""}}});
KISSY.add("kison/item",function(c,f){function d(){d.superclass.constructor.apply(this,arguments)}c.extend(d,f,{equals:function(h,e){return!h.get("production").equals(this.get("production"))||h.get("dotPosition")!=this.get("dotPosition")||!e&&!c.equals(this.get("lookAhead"),h.get("lookAhead"))?!1:!0},toString:function(h){return this.get("production").toString(this.get("dotPosition"))+(h?"":","+c.keys(this.get("lookAhead")).join("/"))},addLookAhead:function(h){var e=this.get("lookAhead"),a=0;c.each(h,
function(b,c){e[c]||(a=e[c]=1)});return a}},{ATTRS:{production:{},dotPosition:{value:0},lookAhead:{value:{}}}});return d},{requires:["base"]});
KISSY.add("kison/item-set",function(c,f){function d(){d.superclass.constructor.apply(this,arguments)}c.extend(d,f,{addItem:function(c){for(var e=this.get("items"),a=0;a<e.length&&!(e[a].get("production").toString()>c.get("production").toString());a++);e.splice(a,0,c)},size:function(){return this.get("items").length},findItemIndex:function(c,e){for(var a=this.get("items"),b=0;b<a.length;b++)if(a[b].equals(c,e))return b;return-1},getItemAt:function(c){return this.get("items")[c]},equals:function(c,
e){var a=this.get("items"),b,l=c.get("items");if(a.length!=l.length)return!1;for(b=0;b<a.length;b++)if(!a[b].equals(l[b],e))return!1;return!0},toString:function(){var h=[];c.each(this.get("items"),function(c){h.push(c.toString())});return h.join("\n")},addReverseGoto:function(c,e){var a=this.get("reverseGotos");a[c]=a[c]||[];a[c].push(e)}},{ATTRS:{items:{value:[]},gotos:{value:{}},reverseGotos:{value:{}}}});return d},{requires:["base"]});
KISSY.add("kison/non-terminal",function(c,f){function d(){d.superclass.constructor.apply(this,arguments)}c.extend(d,f,{},{ATTRS:{productions:{value:[]},firsts:{value:{}},symbol:{},nullAble:{value:!1}}});return d},{requires:["base"]});
KISSY.add("kison/lexer",function(c,f){var d=f.serializeObject,h=function(e){this.rules=[];c.mix(this,e);this.resetInput(this.input)};h.STATIC={INITIAL:"I",DEBUG_CONTEXT_LIMIT:20,END_TAG:"$EOF"};h.prototype={constructor:h,resetInput:function(e){c.mix(this,{input:e,matched:"",stateStack:[h.STATIC.INITIAL],match:"",text:"",firstLine:1,lineNumber:1,lastLine:1,firstColumn:1,lastColumn:1})},genCode:function(e){var a=h.STATIC,b=this,l=e.compressSymbol,f=e.compressLexerState,e=[],o;b.symbolId=b.stateId=0;
l&&(b.symbolMap={},b.mapSymbol(a.END_TAG));f&&(o=b.stateMap={});e.push("var Lexer = "+h.toString()+";");e.push("Lexer.prototype= "+d(h.prototype,/genCode/)+";");e.push("Lexer.STATIC= "+d(a)+";");a=d({rules:b.rules},f||l?function(a){if(a&&a.regexp){var e=a.state,l=a.action,d=a.token||0;d&&(d=b.mapSymbol(d));a=[d,a.regexp,l||0];f&&e&&(e=c.map(e,function(a){return b.mapState(a)}));e&&a.push(e);return a}}:0);e.push("var lexer = new Lexer("+a+");");if(f||l)b.rules=eval("("+a+")").rules,f&&e.push("lexer.stateMap = "+
d(o)+";");return e.join("\n")},getCurrentRules:function(){var e=this.stateStack[this.stateStack.length-1],a=[],e=this.mapState(e);c.each(this.rules,function(b){var d=b.state||b[3];d?c.inArray(e,d)&&a.push(b):e==h.STATIC.INITIAL&&a.push(b)});return a},pushState:function(c){this.stateStack.push(c)},popState:function(){return this.stateStack.pop()},getStateStack:function(){return this.stateStack},showDebugInfo:function(){var c=h.STATIC.DEBUG_CONTEXT_LIMIT,a=this.matched,b=this.match,d=this.input,a=a.slice(0,
a.length-b.length),a=(a.length>c?"...":"")+a.slice(-c).replace(/\n/," "),b=b+d,b=b.slice(0,c)+(b.length>c?"...":"");return a+b+"\n"+Array(a.length+1).join("-")+"^"},mapSymbol:function(c){var a=this.symbolMap;return!a?c:a[c]||(a[c]=++this.symbolId)},mapReverseSymbol:function(c){var a=this.symbolMap,b,d=this.reverseSymbolMap;if(!d&&a)for(b in d=this.reverseSymbolMap={},a)d[a[b]]=b;return d?d[c]:c},mapState:function(c){var a=this.stateMap;return!a?c:a[c]||(a[c]=++this.stateId)},lex:function(){var e=
this.input,a,b,d,f=this.getCurrentRules();this.match=this.text="";if(!e)return this.mapSymbol(h.STATIC.END_TAG);for(a=0;a<f.length;a++){b=f[a];var o=b.token||b[0];d=b.action||b[2]||void 0;if(b=e.match(b.regexp||b[1])){if(a=b[0].match(/\n.*/g))this.lineNumber+=a.length;c.mix(this,{firstLine:this.lastLine,lastLine:this.lineNumber+1,firstColumn:this.lastColumn,lastColumn:a?a[a.length-1].length-1:this.lastColumn+b[0].length});a=this.match=b[0];this.matches=b;this.text=a;this.matched+=a;d=d&&d.call(this);
d=void 0==d?o:this.mapSymbol(d);this.input=e=e.slice(a.length);return d?d:this.lex()}}}};return h},{requires:["./utils"]});
KISSY.add("kison/production",function(c,f){function d(){d.superclass.constructor.apply(this,arguments)}c.extend(d,f,{equals:function(d){return!c.equals(d.get("rhs"),this.get("rhs"))?!1:d.get("symbol")==this.get("symbol")},toString:function(d){var e="",a=this.get("rhs");c.each(a,function(c,a){a==d&&(e+=".");e+=c});d==a.length&&(e+=".");return this.get("symbol")+"=>"+e}},{ATTRS:{firsts:{value:{}},follows:{value:[]},symbol:{},rhs:{value:[]},nullAble:{value:!1},action:{}}});return d},{requires:["base"]});
KISSY.add("kison/grammar",function(c,f,d,h,e,a,b,l){function u(c){var a=0,b;for(b in c)a++;return a}function o(c,a){for(var b=0;b<a.length;b++)if(c.equals(a[b]))return b;return-1}function p(){p.superclass.constructor.apply(this,arguments)}function r(a){var b=this,d=b.lexer,q,j,g=b.table,e=g.gotos,g=g.action,m=b.productions,k=[null],n=[0];for(d.resetInput(a);;){a=n[n.length-1];q||(q=d.lex());if(!q)return!1;j=g[a]&&g[a][q];if(!j){var h=[];g[a]&&c.each(g[a],function(a,c){h.push(b.lexer.mapReverseSymbol(c))});
d.showDebugInfo();h.join(", ");return!1}switch(j[i.TYPE_INDEX]){case i.SHIFT_TYPE:n.push(q);k.push(d.text);n.push(j[i.TO_INDEX]);q=null;break;case i.REDUCE_TYPE:var f=m[j[i.PRODUCTION_INDEX]],a=f.symbol||f[0];j=f.action||f[2];var l=(f.rhs||f[1]).length,o=0,p=void 0,f=k[k.length-l];for(b.$$=f;o<l;o++)b["$"+(l-o)]=k[k.length-1-o];j&&(p=j.call(b));f=void 0!==p?p:b.$$;l&&(n=n.slice(0,-2*l),k=k.slice(0,-1*l));n.push(a);k.push(f);n.push(e[n[n.length-2]][n[n.length-1]]);break;case i.ACCEPT_TYPE:return f}}}
var i={SHIFT_TYPE:1,REDUCE_TYPE:2,ACCEPT_TYPE:0,TYPE_INDEX:0,PRODUCTION_INDEX:1,TO_INDEX:2},s=d.serializeObject,v=c.mix,t=b.STATIC.END_TAG;c.extend(p,f,{build:function(){var a=this.lexer,b=this.get("productions");b.unshift({symbol:"$START",rhs:[b[0].symbol]});c.each(b,function(d,q){d.symbol=a.mapSymbol(d.symbol);var e=d.rhs;c.each(e,function(c,b){e[b]=a.mapSymbol(c)});b[q]=new l(d)});this.buildTerminals();this.buildNonTerminals();this.buildNullAble();this.buildFirsts();this.buildItemSet();this.buildLalrItemSets();
this.buildTable()},buildTerminals:function(){var a=this.get("lexer"),b=a&&a.rules,d=this.get("terminals");d[a.mapSymbol(t)]=1;c.each(b,function(a){(a=a.token||a[0])&&(d[a]=1)})},buildNonTerminals:function(){var b=this.get("terminals"),d=this.get("nonTerminals"),e=this.get("productions");c.each(e,function(e){var j=e.get("symbol"),g=d[j];g||(g=d[j]=new a({symbol:j}));g.get("productions").push(e);c.each(e.get("handles"),function(c){!b[c]&&!d[c]&&(d[c]=new a({symbol:c}))})})},buildNullAble:function(){for(var a=
this,b,d,e,j,g,f,m,k=a.get("nonTerminals"),n=!0;n;)for(j in n=!1,c.each(a.get("productions"),function(c){if(!c.get("nullAble")){d=c.get("rhs");for(e=b=0;g=d[b];++b)a.isNullAble(g)&&e++;e===b&&c.set("nullAble",n=!0)}}),k)if(!k[j].get("nullAble")){m=k[j].get("productions");for(b=0;f=m[b];b++)if(f.get("nullAble")){k[j].set("nullAble",n=!0);break}}},isNullAble:function(a){var c=this.get("nonTerminals");if(a instanceof Array){for(var c=0,b;b=a[c];++c)if(!this.isNullAble(b))return!1;return!0}return c[a]?
c[a].get("nullAble"):!1},findFirst:function(a){var c={},b,d,e=this.get("nonTerminals");if(a instanceof Array){for(d=0;(b=a[d])&&!(e[b]?v(c,e[b].get("firsts")):c[b]=1,!this.isNullAble(b));++d);return c}return e[a]?e[a].get("firsts"):[a]},buildFirsts:function(){var a=this,b;a.get("productions");for(var d=a.get("nonTerminals"),e=!0,j,g;e;)for(j in e=!1,c.each(a.get("productions"),function(b){var c=a.findFirst(b.get("rhs"));u(c)!==u(b.get("firsts"))&&(b.set("firsts",c),e=!0)}),d)b=d[j],g={},c.each(b.get("productions"),
function(a){v(g,a.get("firsts"))}),u(g)!==u(b.get("firsts"))&&(b.set("firsts",g),e=!0)},closure:function(a){for(var b=this,d=a.get("items"),e=b.get("productions"),j=1;j;)j=!1,c.each(d,function(d){var f=d.get("dotPosition"),m=d.get("production").get("rhs"),k=m[f],d=d.get("lookAhead"),n={};c.each(d,function(a,d){var e=m.slice(f+1);e.push(d);c.mix(n,b.findFirst(e))});c.each(e,function(b){if(b.get("symbol")==k){var b=new h({production:b}),c=a.findItemIndex(b,!0);-1!=c?(b=a.getItemAt(c),j=j||!!b.addLookAhead(n)):
(b.addLookAhead(n),a.addItem(b),j=!0)}})});return a},gotos:function(a,b){var d=new e,f=a.get("items");c.each(f,function(a){var c=a.get("production"),e=a.get("dotPosition");c.get("rhs")[e]==b&&(c=new h({production:c,dotPosition:e+1}),e=d.findItemIndex(c,!0),-1!=e?(c=d.getItemAt(e),c.addLookAhead(a.get("lookAhead"))):(c.addLookAhead(a.get("lookAhead")),d.addItem(c)))});return this.closure(d)},findItemSetIndex:function(a){var b=this.get("itemSets"),c;for(c=0;c<b.length;c++)if(b[c].equals(a))return c;
return-1},buildItemSet:function(){var a=this,b=a.lexer,d=a.get("itemSets"),f={},j=a.get("productions");f[b.mapSymbol(t)]=1;f=a.closure(new e({items:[new h({production:j[0],lookAhead:f})]}));d.push(f);var g=!0,i=c.merge(a.get("terminals"),a.get("nonTerminals"));for(delete i[b.mapSymbol(t)];g;)g=!1,b=d.concat(),c.each(b,function(b){c.each(i,function(c,e){b.__cache||(b.__cache={});if(!b.__cache[e]){var f=a.gotos(b,e);b.__cache[e]=1;if(0!=f.size()){var j=a.findItemSetIndex(f);-1<j?f=d[j]:(d.push(f),g=
!0);b.get("gotos")[e]=f;f.addReverseGoto(e,b)}}})})},buildLalrItemSets:function(){var a=this.get("itemSets"),b,d,e,f;for(b=0;b<a.length;b++){e=a[b];for(d=b+1;d<a.length;d++)if(f=a[d],e.equals(f,!0)){for(var g=0;g<e.get("items").length;g++)e.get("items")[g].addLookAhead(f.get("items")[g].get("lookAhead"));var h=e.get("gotos");c.each(f.get("gotos"),function(a,b){h[b]=a;a.addReverseGoto(b,e)});c.each(f.get("reverseGotos"),function(a,b){c.each(a,function(a){a.get("gotos")[b]=e;e.addReverseGoto(b,a)})});
a.splice(d--,1)}}},buildTable:function(){var a=this.lexer,b=this.get("table"),d=this.get("itemSets"),e=this.get("productions"),f={},g={},h,m,k;b.gotos=f;b.action=g;h=this.get("nonTerminals");for(m=0;m<d.length;m++)b=d[m],c.each(b.get("gotos"),function(a,b){h[b]?(f[m]=f[m]||{},f[m][b]=o(a,d)):(g[m]=g[m]||{},k=g[m][b]=[],k[i.TYPE_INDEX]=i.SHIFT_TYPE,k[i.PRODUCTION_INDEX]=0,k[i.TO_INDEX]=o(a,d))}),c.each(b.get("items"),function(b){var d=b.get("production");b.get("dotPosition")==d.get("rhs").length&&
(d.get("symbol")==a.mapSymbol("$START")?b.get("lookAhead")[a.mapSymbol(t)]&&(g[m]=g[m]||{},k=g[m][a.mapSymbol(t)]=[],k[i.TYPE_INDEX]=i.ACCEPT_TYPE,k[i.TO_INDEX]=k[i.PRODUCTION_INDEX]=0):(g[m]=g[m]||{},c.each(b.get("lookAhead"),function(a,b){k=g[m][b]=[];k[i.TYPE_INDEX]=i.REDUCE_TYPE;k[i.TO_INDEX]=0;k[i.PRODUCTION_INDEX]=c.indexOf(d,e)})))})},visualizeTable:function(){var a=this.get("table"),b=a.gotos,a=a.action,d=this.get("productions"),e=[];c.each(this.get("itemSets"),function(a,b){e.push(Array(70).join("*")+
" itemSet : "+b);e.push(a.toString());e.push("")});e.push("");e.push(Array(70).join("*")+" table : ");c.each(a,function(a,b){c.each(a,function(a,c){var f,h=a[i.TYPE_INDEX];h==i.ACCEPT_TYPE?f="acc":h==i.REDUCE_TYPE?(f=d[a[i.PRODUCTION_INDEX]],f="r, "+f.get("symbol")+"="+f.get("rhs").join(" ")):h==i.SHIFT_TYPE&&(f="s, "+a[i.TO_INDEX]);e.push("action["+b+"]["+c+"] = "+f)})});e.push("");c.each(b,function(a,b){c.each(a,function(a,c){e.push("goto["+b+"]["+c+"] = "+a)})});return e},genCode:function(a){var a=
a||{},b=this.get("table"),d=this.get("lexer"),e=d.genCode(a);this.build();var f=[];c.each(this.get("productions"),function(a){var b=a.get("action"),a=[a.get("symbol"),a.get("rhs")];b&&a.push(b);f.push(a)});var g=[];g.push("/* Generated by kison from KISSY */");g.push("var parser = {},S = KISSY,GrammarConst = "+s(i)+";");g.push(e);g.push("parser.lexer = lexer;");a.compressSymbol&&g.push("lexer.symbolMap = "+s(d.symbolMap)+";");g.push("parser.productions = "+s(f)+";");g.push("parser.table = "+s(b)+
";");g.push("parser.parse = "+r.toString()+";");g.push("return parser;");return g.join("\n")}},{ATTRS:{table:{value:{}},itemSets:{value:[]},productions:{value:[]},nonTerminals:{value:{}},lexer:{setter:function(a){a instanceof b||(a=new b(a));return this.lexer=a}},terminals:{value:{}}}});return p},{requires:"base,./utils,./item,./item-set,./non-terminal,./lexer,./production".split(",")});
KISSY.add("kison",function(c,f,d,h,e){var a={};a.Grammar=f;a.Production=d;a.Lexer=h;a.Utils=e;return!c.trim("")?(alert("kison can only use uncompressed version!"),null):a},{requires:["kison/grammar","kison/production","kison/lexer","kison/utils"]});
